<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
	<title>Landing Page Divination by Tarot Cards</title>
	<meta name="description" content="Personal tarot reader website developed with JavaScript." />
	<link rel="shortcut icon" href="/favicon.png" sizes="16x16 32x32" type="image/png">
	<link rel="stylesheet" href="../../css/style.css">
</head>

<body>

		<aside class="aside"></aside>

		<section class="sheet single-work">

			<div class="row single-work__desc">
				<div class="col-6">
					<h1>Landing Page Divination by Tarot Cards&nbsp;
						<a rel="nofollow" class="btn btn-tertiary" href="https://daria-bloom.make-website.ru/" target="_blank" title="Visit site"><i data-feather="corner-up-right"></i><span>Visit site</span></a></h1>
					<ul class="list-framed">
						<li>PUG</li>
						<li>SCSS</li>
						<li>JavaScript</li>
						<li>Modx</li>
					</ul>
					<p>Personal website of tarologist Daria Bloom. Fortune-telling on Tarot cards: by photo and date of birth, you will receive a detailed prediction on old cards remotely around the world.</p>
				</div>

				<div class="col-6 flexbox">
					<img src="../works-tarot.jpg" alt="Development of a personal website for a tarologist">
				</div>
			</div>

      <div class="smarttabs">
				<div class="row single-work__menu">
					<div class="col-6">
						<div class="smarttabs__nav">
		          <a class="smarttabs__navlink active" href="#tabdesc"><span>Description</span></a>
		          <a class="smarttabs__navlink" href="#tabmedia">Screenshots<span>&nbsp;& Video</span></a>
		          <a class="smarttabs__navlink" href="#tabcode">Code</a>
		        </div>
					</div>
					<div class="col-6">
						<a class="icon-link" href="/works/"><i data-feather="arrow-left"></i>Back to the works list</a>
					</div>
				</div>

        <div class="smarttabs__content">
          <div class="smarttabs__tabcontent active" id="tabdesc">

						<div class="container">
							<h2>Completed works</h2>
	            <ol>
	              <li><strong>Design</strong>: creation in Photoshop, drawing graphics, backgrounds and icons.</li>
	              <li><strong>Layout</strong> was carried out using <a href="https://github.com/liutkin/crystalball" target="_blank">Crystalball</a> (It is a web app project scaffolding tool powered with <strong>GULP</strong> for frontend development. Out-of-the box it has: <strong>PUG</strong> templating, <strong>SASS</strong> styling, <strong>WEBPACK</strong> bundler).</li>
	              <li><strong>Integration with cms MODx</strong>. Using MIGX for FAQ, Testimonials and Photo Gallery blocks.</li>
	            </ol>

	            <h2>JS libraries used</h2>
	            <ul>
	              <li><a rel="nofollow" href="https://github.com/Splidejs/splide" target="_blank">Splide</a> slider for reviews.</li>
	            	<li><a rel="nofollow" href="https://sachinchoolur.github.io/lightgallery.js/" target="_blank">Lightgallery</a> for images gallery.</li>
	            </ul>

							<h2>Implemented on the site</h2>
							<ol>
								<li>Preloader.</li>
								<li>Animations (JavaScript + Css) of elements on scroll.</li>
								<li>Mobile menu.</li>
								<li>Sliders, accordion, photo gallery, pop-up windows (user consent), php feedback form.</li>
								<li>Hover effects for the logo and icons.</li>
								<li>Different images for different screens (&lt;picture&gt;).</li>
								<li>Daily tarot card generator (JavaScript widget): (section Card of the day - your prediction for today). After clicking on the Select card button, a loading animation occurs and a random card with a flip effect and a description of this card appear. If the visitor reloads the page and clicks on this button again, the inscription will appear: Today you have already chosen your card.</li>
								<li>Block Share in social networks.</li>
								<li>Adaptability.</li>
							</ol>

							<h2>Page sections</h2>
	            <ul>
	              <li><strong>Intro</strong>: short description of the service.</li>
	              <li><strong>About</strong>: text and certificate.</li>
	              <li><strong>Service</strong>: detailed description of the service.</li>
	              <li><strong>Reviews</strong>: carousel.</li>
	              <li><strong>FAQ</strong>: accordion with input type radio.</li>
	              <li><strong>Card of the day</strong>: withdrawal of a random tarot card by clicking on the Select card button with the ability to do this only once a day (<span class="bg-p">localStorage</span>).</li>
	              <li><strong>Gallery</strong> of images.</li>
	              <li><strong>Contact</strong> with feedback form (<span class="bg-r">PHP + JavaScript</span>).</li>
	            </ul>

						</div>
          </div>

          <div class="smarttabs__tabcontent" id="tabmedia">
						<div class="stickytabs work-stickytabs">
						  <div class="stickytabs__aside">
						    <ul class="stickytabs__nav">
						      <li class="stickytabs__navitem"><i data-feather="image"></i> Landing page</li>
						      <li class="stickytabs__navitem"><i data-feather="image"></i> Card of the day</li>
						      <li class="stickytabs__navitem"><i data-feather="image"></i> Admin-panel: photogallery</li>
						      <li class="stickytabs__navitem"><i data-feather="image"></i> Admin-panel: reviews</li>
						      <li class="stickytabs__navitem"><i data-feather="film"></i> Video: desktop</li>
						      <li class="stickytabs__navitem"><i data-feather="film"></i> Video: mobile</li>
						    </ul>
						  </div>

						  <div class="stickytabs__article">
						    <div class="stickytabs__content">
						      <img class="lazy" src="./tarot-1-th.jpg" alt="Landing Page Divination by Tarot Cards" />
						    </div>
						    <div class="stickytabs__content">
						      <img src="./tarot-gif.gif" alt="Daily tarot card generator (JavaScript widget)" />
						      <img src="./tarot-2.jpg" alt="JavaScript tarot card generator" />
						    </div>
						    <div class="stickytabs__content">
						      <img src="./tarot-3.jpg" alt="Modx admin panel: photogallery" />
						    </div>
						    <div class="stickytabs__content">
						      <img src="./tarot-4.jpg" alt="Modx admin panel: reviews" />
						    </div>
						    <div class="stickytabs__content">
						      <video controls="" width="960" height="470" poster="./tarot-desktop-poster.jpg" preload="none">
						        <source src="./tarot-video-desktop.mp4" type="video/mp4">
						      </video>
						    </div>
						    <div class="stickytabs__content">
						      <video controls="" width="800" height="800" poster="./tarot-mobile-poster.jpg" preload="none">
						        <source src="./tarot-video-mobile.mp4" type="video/mp4">
						      </video>
						    </div>
						  </div>
						</div>
          </div>

          <div class="smarttabs__tabcontent" id="tabcode">
						<div class="container">

							<p><a target="_blank" href="https://github.com/yegupov/yegupov.github.io/tree/master/tarot/code">View all folders and files</a></p>
							<p>Here below is just the script file:</p>

							<figure class="codepre">
								<figcaption id="example1-caption">app.js</figcaption>
									<pre
										aria-describedby="example1-description"
										aria-labelledby="example1-caption">
										<code class="prettyprint">const bodyTag = document.querySelector('body');
const navToggler = document.querySelector('.nav-toggler');
const navMenu = document.querySelector('.navbar-list');
const navLinks = document.querySelectorAll('.site-navbar a');
const animatedElements = document.querySelectorAll('[data-animation]');
const flipButton = document.getElementById('flipButton');
const cardofday = document.getElementById('cardofday');
const flipContainer = document.querySelectorAll('.flip-container')[0];
const photoGallery = document.getElementById('lightgallery');
const loaderEl = document.getElementsByClassName('fullpage-loader')[0];
const scrollToTopButton = document.getElementById('js-top');

let isScrolling = false,
    widthWindow = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth,
    heightWindow = document.documentElement.clientHeight || window.innerHeight || document.body.clientHeight;

// Show Scroll-to-top button
const toggleScrollToTopBtn = () => {
  let y = window.scrollY;
  if (y > 0) {
    scrollToTopButton.className = "top-link show";
  } else {
    scrollToTopButton.className = "top-link hide";
  }
};

if (localStorage.getItem('cardofdaySelect') == null) {
  localStorage.setItem('cardofdaySelect', '0');
}

// load all event listners
allEventListners();

new Splide( '#reviewsList', {
  	type   : 'loop',
  	perPage: 2,
    breakpoints: {
  		991: {
  			perPage: 1,
  		}
  	},
  	perMove: 1,
    pagination: false
  } ).mount();

lightGallery(document.getElementById('certificate'), {
  download: false
});

lightGallery(photoGallery, {
  download: false
});
addClassGalleryItems(photoGallery);

hideFlipButton();

// POP-UP Window
const modalTriggers = document.querySelectorAll('.popup-trigger');
const modalCloseTrigger = document.querySelector('.popup-modal__close');
const bodyBlackout = document.querySelector('.body-blackout');

modalTriggers.forEach(trigger => {
  trigger.addEventListener('click', (event) => {
    event.preventDefault();
    const { popupTrigger } = trigger.dataset;
    const popupModal = document.querySelector(`[data-popup-modal="${popupTrigger}"]`);

    popupModal.classList.add('is--visible');
    bodyBlackout.classList.add('is-blacked-out');
    bodyTag.classList.add('popup-bottom');

    popupModal.querySelector('.popup-modal__close').addEventListener('click', () => {
       popupModal.classList.remove('is--visible');
       bodyBlackout.classList.remove('is-blacked-out');
       bodyTag.classList.remove('popup-bottom');
    });

    bodyBlackout.addEventListener('click', () => {
      // TODO: Turn into a function to close modal
      popupModal.classList.remove('is--visible');
      bodyBlackout.classList.remove('is-blacked-out');
      bodyTag.classList.remove('popup-bottom');
    });
  });
});

// functions of all event listners
function allEventListners() {

  document.addEventListener('readystatechange', hidePreloader);

  navToggler.addEventListener('click', toggleMenu);

  navLinks.forEach( elem => elem.addEventListener('click', navLinkClick)); // Nav links click event
  // Animations
  window.addEventListener("scroll", throttleScroll, false);
  document.addEventListener("DOMContentLoaded", scrolling, false);

  flipButton.addEventListener('click', showTarotCard, false);

  window.addEventListener("scroll", toggleScrollToTopBtn);

  window.addEventListener('resize', function(event){
    widthWindow = window.innerWidth || document.documentElement.clientWidth || document.body.clientWidth;
    addClassGalleryItems(photoGallery);
    if(widthWindow > 767 && navMenu.classList.contains('open')) {
      navToggler.classList.remove('toggler-open');
      navMenu.classList.remove('open');
      navMenu.style.height = "auto";
      bodyTag.classList.remove('noscroll');
    }
  });

  scrollToTopButton.onclick = function(e) {
    e.preventDefault();
    window.scrollTo(pageXOffset, 0);
  }
}

// Preloader
function hidePreloader(event) {
	const readyState = "complete";

	if(document.readyState == readyState) {
		// when document ready add lass to fadeout loader
		loaderEl.classList.add('fullpage-loader--invisible');

		// when loader is invisible remove it from the DOM
		setTimeout( () => {
			loaderEl.parentNode.removeChild(loaderEl);
		}, 2000)
  }
}

// Show Card of Day
function showTarotCard() {
  const cardDescContainer = document.querySelector('.card-ofday-description'),
        imageSelectedCard = document.getElementById('imageSelectedCard'),
        imageAndQuoteContainer = document.querySelector('.card-ofday-image'),
        quoteEl = document.createElement('div'),
        cardsQty = 10,
        randomNumber = Math.trunc(Math.random() * cardsQty + 1);

  localStorage.setItem('cardofdaySelect', '1');
  imageSelectedCard.setAttribute('src', '../img/card-ofday/card-' + randomNumber + '.gif');

  quoteEl.className = 'card-ofday-quote';
  cardofday.setAttribute('src', cardofday.getAttribute('data-src'));

  setTimeout( () => {
    flipContainer.classList.add('hover');
  }, 2700);

  setTimeout( () => {
    // Get Html code from "D:\Dev\daria-bloom\dev\cards"
    const getCardDescription = function() {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '../cards/card-' + randomNumber + '.html');
      xhr.onload = function() {
          cardDescContainer.innerHTML = xhr.response;

          quoteEl.innerHTML = document.querySelector('.card-ofday-content').getAttribute('data-quote');
          flipButton.closest('.half-row').classList.add('content'); // Hide .card-ofday-intro, .btns-block
          imageAndQuoteContainer.append(quoteEl);
      }
      xhr.send()
    }
    getCardDescription();
  }, 3000);
}

function hideFlipButton() {
  // localStorage.clear();
  let date = new Date(),
      todaysDate = +date.getDate();

  if (localStorage.getItem('date') == null || localStorage.getItem('date') != todaysDate) {
    localStorage.setItem('date', todaysDate);

  } else {
    if (localStorage.getItem('cardofdaySelect') === '1') {
      flipButton.style.display = "none";
      const messForUser = document.createElement("p");
      messForUser.classList.add('card-ofday-mess');
      messForUser.innerHTML = "Сегодня Вы уже выбрали свою карту дня."
      flipButton.after(messForUser);
    }
  }
}

function addClassGalleryItems(gallery) {
  let specialItems = [],
      odd = true,
      serialNumber = 0,
      i = 0;
  const differenceOne = 2,
        differenceTwo = 3;

  while (i < 20) {
    if (i === 0) {
      specialItems.push(serialNumber + differenceOne);
      serialNumber += differenceOne;
    } else {
      if (odd) {
        specialItems.push(serialNumber + differenceTwo);
        serialNumber += differenceTwo;
      } else {
        specialItems.push(serialNumber + differenceOne);
        serialNumber += differenceOne;
      }
    }

    odd = !odd;
    i++;
  }
  const galleryItems = gallery.children;
  for (let i = 0, child; child = galleryItems[i]; i++) {
    if (specialItems.includes(i)) {
      if (widthWindow > 600) child.classList.add('right');
      else child.classList.remove('right');
    }
  }
}

// Mobile Menu
function toggleMenu() {
  navToggler.classList.toggle('toggler-open');
  bodyTag.classList.toggle('noscroll');
  // navMenu.classList.toggle('open');
  slideDownUp(navMenu);
}
// navLinkClick function
function navLinkClick() {
  if(navMenu.classList.contains('open')) {
    navToggler.click();
  }
}

function slideDownUp(elem) {
  if(!elem.classList.contains('open')) {
  	elem.classList.add('open');
    let heightElem = 0;

    if(!elem.classList.contains('navbar-list')) {
      elem.style.height = "auto"
      heightElem = elem.clientHeight + "px"
    } else {
      heightElem = widthWindow > 480 ? heightWindow - 109 + "px" : heightWindow - 119 + "px"
    }

    elem.style.height = "0px"

    setTimeout(() => {
      elem.style.height = heightElem
    }, 0)

  } else {  /** Slide up. */
  	elem.style.height = "0px"
    /** Remove the `open` class when the animation ends. */
  	elem.addEventListener('transitionend', () => {
    	elem.classList.remove('open')
    }, {once: true})
  }
}

// Animations
function throttleScroll(e) {
  if (isScrolling == false) {
    window.requestAnimationFrame(function() {
      scrolling(e);
      isScrolling = false;
    });
  }
  isScrolling = true;
}

function scrolling(e) {
  animatedElements.forEach((elem) => {
    if (isFullyVisible(elem)) elem.classList.add('animated', elem.getAttribute('data-animation'));
    if (isPartiallyVisible(elem)) {
      elem.classList.add('animated', elem.getAttribute('data-animation'));
    } else {
      elem.classList.remove('animated', elem.getAttribute('data-animation'));
    }
  })
}

function isPartiallyVisible(el) {
  const elementBoundary = el.getBoundingClientRect(),
        top = elementBoundary.top,
        bottom = elementBoundary.bottom,
        height = elementBoundary.height;
  return ((top + height >= 0) && (height + window.innerHeight >= bottom + 80));
}

function isFullyVisible(el) {
  const elementBoundary = el.getBoundingClientRect(),
        top = elementBoundary.top,
        bottom = elementBoundary.bottom;

  return ((top >= 0) && (bottom + 80 <= window.innerHeight));
}

async function sendForm(e) {
  e.preventDefault();
  const contactName = document.getElementById('contactName'),
      contactEmail = document.getElementById('contactEmail'),
      contactMess = document.getElementById('contactMess'),
      contactFields = [contactName, contactEmail, contactMess];
  let formValid = true;

  // console.log('Contact Fields : ', contactFields);

  contactFields.forEach( (field) => {
    field.classList.remove('error');
    formValid = true;
  });

  contactFields.forEach( (field) => {
    if (field.value === '') {
      field.classList.add('error');
      formValid = false;
    }
  });

  if (formValid) {
    let response = await fetch('https://daria-bloom.ru/mail.php', {
      method: 'post',
      headers: {
        'Content-Type': 'application/json;charset=utf-8'
      },
      body: JSON.stringify({
        name: contactName.value,
        email: contactEmail.value,
        mess: contactMess.value
      })
    });

    let resultForm = await response.json();

    console.log('Message : ', resultForm.message);

    contactMessages.innerHTML = resultForm.message;
  } else {
    contactMessages.innerHTML = "<span style='color:red;'>Заполните все поля!</span>";
  }

}
									</code></pre>
								</figure>

						</div>
          </div>

        </div> <!-- END smarttabs__content -->
      </div>

    </section>

	<footer class="footer"></footer>

	<a class="top-link hide" id="js-scrolltotop" href="#"><i data-feather="arrow-up"></i><span class="screen-reader-text">Back to top</span></a>

	<script src="https://unpkg.com/feather-icons"></script>
	<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
	<script src="../../js/script.js"></script>
</body>
</html>
